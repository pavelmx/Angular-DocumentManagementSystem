<div *ngIf="isLogin; else notLogin">
<div  class="text-center">
  <h1 *ngIf=isEdit class="display-4 ">{{form.title}}*</h1>
  <h1 *ngIf=!isEdit class="display-4 ">{{form.title}}</h1>
</div>

<h1 *ngIf="addMode==true" class="display-4 ">Add new document</h1>
<h3 *ngIf="form.expired == false" style="color:green">Active document</h3>
<h3 *ngIf="form.expired == true" style="color:red">Expired document</h3>
<hr>
<label >Attached file</label>
<div  class="row">
  <div class="col">
    <div class="input-group">
      <input type="text" class="form-control" readonly [(ngModel)]="form.filename" #filename="ngModel"
        aria-describedby="button-addon4" placeholder="Attached file not found">
      <div class="input-group-append" id="button-addon4">
          <button class="btn btn-danger" [disabled]="!form.filename" (click)="deleteFile(form.filename)"
          type="button">Delete file</button>
        <button class="btn btn-success" [disabled]="!form.filename" (click)="downloadFile()"
          type="button">Download </button>
        <button class="btn btn-warning" type="button" [disabled]="show" (click)=showUploadPanel()>Update</button>
      </div>
    </div>
  </div>
  <br>
  <div *ngIf="show" class="col">
    <div class="input-group">
      <div class="custom-file">
        <input type="file" class="form-control" aria-describedby="inputGroupFileAddon04" id="inputGroupFile04"
          (change)="selectFile($event)">
        <label class="custom-file-label" for="inputGroupFile04"></label>
      </div>
      <div class="input-group-append">
        <button class="btn btn-warning" [disabled]="!selectedFile" id="inputGroupFileAddon04" type="button"
          (click)="uploadFile()">Upload file</button>
        <button class="btn btn-danger" type="button" (click)=showUploadPanel()>Cancel</button>
      </div>
    </div>
  </div></div><br>
  <div class="row">
      <small *ngIf="isFailedDownload" class="form-text alert alert-danger">
        File can't be download, maybe it was deleted from storage.
      </small>
    </div>

<br>
<form (change)="change()" (ngSubmit)="f.form.valid && updateDoc()" #f="ngForm" novalidate>
  <div class="row">
    <div class="col">
      <label for="id">Id</label>
      <input type="text" class="form-control" placeholder="auto complete" name="id" [(ngModel)]="form.id" #id="ngModel" disabled />      
    </div>
    <div class="col">
      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" class="form-control" name="title" [(ngModel)]="form.title" #title="ngModel" 
        required  disabled/>        
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <div class="form-group">
        <label for="dateOfCreation">Date of creation</label>
        <input type="date" class="form-control" name="dateOfCreation" [(ngModel)]="form.dateOfCreation"
          #dateOfCreation="ngModel" 
           [ngClass]="{'is-valid':dateOfCreation.valid ,'is-invalid':dateOfCreation.invalid }"/>
          <div *ngIf="f.submitted && dateOfCreation.invalid ||  dateOfCreation.invalid">
            <small class="form-text alert alert-warning" *ngIf="dateOfCreation.errors.required">Date of creation is required</small>            
          </div>
      </div>
    </div>
    <div class="col">
      <div class="form-group">
        <label for="contractTerm">Contract term(days)</label>
        <input type="number"  min="1" class="form-control" name="contractTerm" [(ngModel)]="form.contractTerm"
          #contractTerm="ngModel" required 
          [ngClass]="{'is-valid':contractTerm.valid ,'is-invalid':contractTerm.invalid }"/>
          <div *ngIf="f.submitted && contractTerm.invalid ||  contractTerm.invalid">
            <small class="form-text alert alert-warning" *ngIf="contractTerm.errors.required">Contract term is required</small>            
          </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <div class="form-group">
        <label for="customer">Customer</label>
        <input type="text" class="form-control" name="customer" [(ngModel)]="form.customer" #customer="ngModel"
          required [ngClass]="{'is-valid':customer.valid ,'is-invalid':customer.invalid }"/>
          <div *ngIf="f.submitted && customer.invalid ||  customer.invalid">
            <small class="form-text alert alert-warning" *ngIf="customer.errors.required">Customer term is required</small>            
          </div>
      </div>
    </div>
    <div class="col ">
      <div class="form-group">
        <label for="documentDescription">Document description</label>
        <textarea required minlength="20" class="form-control" name="documentDescription" rows="4"
          [(ngModel)]="form.documentDescription" #documentDescription="ngModel"
          [ngClass]="{'is-valid':documentDescription.valid,'is-invalid':documentDescription.invalid }"></textarea>
          <div *ngIf="f.submitted && documentDescription.invalid || documentDescription.invalid">
            <small class="form-text alert alert-warning" *ngIf="documentDescription.errors.required">Description is required</small> 
            <small class="form-text alert alert-warning" *ngIf="documentDescription.errors.minlength">Description must be at least 20 characters</small>            
          </div>
      </div>

    </div>
  </div>

  <div class="form-group">
      <hr>
      <button *ngIf="isEdit" [disabled]="title.invalid || documentDescription.invalid || customer.invalid || contractTerm.invalid" 
       class="btn btn-success" (click)="updateDoc()">Update document</button>
    
  <div><br></div>
  <small *ngIf="f.submitted && isFailed" class="form-text alert alert-danger">
    {{errorMessageUpdate}}
  </small>
</div>
</form>
</div>

<ng-template #notLogin>
    <div class="alert alert-danger" role="alert">
      <h2 class="alert-heading">Oops...</h2>
      <hr>
      <h5 class="mb-0">Unauthorized users are denied access. Please <a routerLink="/login" class="alert-link">login</a>!
      </h5>
    </div>
  </ng-template>